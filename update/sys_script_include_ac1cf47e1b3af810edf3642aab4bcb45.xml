<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_script_include">
    <sys_script_include action="INSERT_OR_UPDATE">
        <access>public</access>
        <active>true</active>
        <api_name>x_snc_datasilos.AppBuilder</api_name>
        <caller_access/>
        <client_callable>false</client_callable>
        <description>The function turns an existing scoped app into a DataSilos plugin app and adds all components required to support a given set of tables.</description>
        <name>AppBuilder</name>
        <script>function AppBuilder(strAppSysIdOrScopeName,aTables)&#13;
{&#13;
/*&#13;
	x_snc_datasilos.AppBuilder('x_snc_datasilos',[&#13;
		'incident',&#13;
		'incident_task',&#13;
		'change_request',&#13;
		'change_task',&#13;
		'problem',&#13;
		'problem_task',&#13;
		'sc_request',&#13;
		'sc_req_item',&#13;
		'sc_task']);&#13;
*/	&#13;
	&#13;
/*&#13;
	x_snc_datasilos.AppBuilder('x_snc_datasilosci',['cmdb_ci']);&#13;
*/	&#13;
	&#13;
	&#13;
	&#13;
	&#13;
	&#13;
	var GetStringValue = x_snc_devtools.GetStringValue;&#13;
	var GetArrayValue = x_snc_devtools.GetArrayValue;&#13;
	var RenderValue = x_snc_devtools.RenderValue;&#13;
	var IsValidTable = x_snc_devtools.IsValidTable;&#13;
	var GlideRecordInsert = x_snc_devtools.GlideRecordInsert;&#13;
	var GlideRecordUpdate = x_snc_devtools.GlideRecordUpdate;&#13;
	var IsValidSysId = x_snc_devtools.IsValidSysId;&#13;
	var RecordGetValue = x_snc_devtools.RecordGetValue;&#13;
&#13;
	function Log(strText)&#13;
	{&#13;
		x_snc_datasilos.Log('AppBuilder: '+strText);&#13;
	}&#13;
	&#13;
	var grApp = x_snc_devtools.AppBuilder(&#13;
		strAppSysIdOrScopeName,&#13;
		'949c7f2fdbb78450ba15a353059619d6'); // DataSilos application menu&#13;
	if (grApp == false)&#13;
	{&#13;
		Log('Error: x_snc_devtools.AppBuilder returned false.');&#13;
		return false;&#13;
	}&#13;
	&#13;
	var strAppSysId = GetStringValue(grApp.sys_id);&#13;
	var strAppScope = GetStringValue(grApp.scope); &#13;
	var strAppVersion = GetStringValue(grApp.version);&#13;
	var strDataSilosVersion = RecordGetValue('sys_app','dafbffebdbb78450ba15a353059619eb','version');&#13;
	&#13;
	var aTables = GetArrayValue(aTables);&#13;
	&#13;
	Log('AppBuilder is working on app '+strAppScope+'. The following tables will be supported: '+RenderValue(aTables));&#13;
	&#13;
&#13;
	&#13;
	// Adding script include "DataSilosGetConfig"&#13;
	var grSSI = new GlideRecord('sys_script_include');&#13;
	grSSI.addQuery('sys_scope','=',strAppSysId);&#13;
	grSSI.addQuery('name','=','DataSilosGetConfig');&#13;
	grSSI.query();&#13;
	if (grSSI.getRowCount() != 0)&#13;
	{&#13;
		Log('Script include "DataSilosGetConfig" already exists...');&#13;
	}&#13;
	else&#13;
	{&#13;
		Log('Adding script include "DataSilosGetConfig"...');&#13;
		var grSSI = new GlideRecord('sys_script_include');&#13;
		grSSI.initialize();&#13;
		grSSI.name = 'DataSilosGetConfig';&#13;
		grSSI.description = "The DataSilosGetConfig is called by the DataSilos extension point instance class and returns the config object with all relevant changes and additions.";&#13;
		grSSI.sys_scope = strAppSysId;&#13;
		grSSI.access = 'public';&#13;
		grSSI.caller_access = '1';&#13;
		grSSI.script = ""&#13;
			+"function DataSilosGetConfig(config)\n"&#13;
			+"{\n"&#13;
			+"\treturn config;\n"&#13;
			+"}";&#13;
		strSSI = GlideRecordInsert(grSSI);&#13;
		Log('Script include "DataSilosGetConfig": '+RenderValue(strSSI));	&#13;
	}&#13;
	&#13;
	&#13;
	// Adding script include "DataSilosGetRelatedRecords"&#13;
	var grSSI = new GlideRecord('sys_script_include');&#13;
	grSSI.addQuery('sys_scope','=',strAppSysId);&#13;
	grSSI.addQuery('name','=','DataSilosGetRelatedRecords');&#13;
	grSSI.query();&#13;
	if (grSSI.getRowCount() != 0)&#13;
	{&#13;
		Log('Script include "DataSilosGetRelatedRecords" already exists...');&#13;
	}&#13;
	else&#13;
	{&#13;
		Log('Adding script include "DataSilosGetRelatedRecords"...');&#13;
		var grSSI = new GlideRecord('sys_script_include');&#13;
		grSSI.initialize();&#13;
		grSSI.name = 'DataSilosGetRelatedRecords';&#13;
		grSSI.description = "The DataSilosGetRelatedRecords function is called by the DataSilos extension point instance class and returns an array of related records to the given record. If the record does not have any related records the function should return an empty array. If the function returns false, the default DataSilos function or other extensions will provide the related records.";&#13;
		grSSI.sys_scope = strAppSysId;&#13;
		grSSI.access = 'public';&#13;
		grSSI.caller_access = '1';&#13;
		grSSI.script = ""&#13;
			+"function DataSilosGetRelatedRecords(record)\n"&#13;
			+"{\n"&#13;
			+"\tvar IsValidRecord = x_snc_devtools.IsValidRecord;\n"&#13;
			+"\tvar RenderValue = x_snc_devtools.RenderValue;\n"&#13;
			+"\n"&#13;
			+"\tvar aRelatedRecords = [];\n"&#13;
			+"\n"&#13;
			+"\tvar strTable = x_snc_datasilos.GetSupportedTableFromRecord(record);\n"&#13;
			+"\n"&#13;
			+"\treturn false;\n"&#13;
			+"}";&#13;
		strSSI = GlideRecordInsert(grSSI);&#13;
		Log('Script include "DataSilosGetRelatedRecords": '+RenderValue(strSSI));	&#13;
	}	&#13;
&#13;
	&#13;
	&#13;
	// Adding script include "DataSilosRecordInsert"&#13;
	var grSSI = new GlideRecord('sys_script_include');&#13;
	grSSI.addQuery('sys_scope','=',strAppSysId);&#13;
	grSSI.addQuery('name','=','DataSilosRecordInsert');&#13;
	grSSI.query();&#13;
	if (grSSI.getRowCount() != 0)&#13;
	{&#13;
		Log('Script include "DataSilosRecordInsert" already exists...');&#13;
	}&#13;
	else&#13;
	{&#13;
		Log('Adding script include "DataSilosRecordInsert"...');&#13;
		var grSSI = new GlideRecord('sys_script_include');&#13;
		grSSI.initialize();&#13;
		grSSI.name = 'DataSilosRecordInsert';&#13;
		grSSI.description = "The DataSilosRecordInsert function is called by the DataSilos extension point instance class and processes a record when it is inserted into a table. Return true if the record is handled by the function, false if not.";&#13;
		grSSI.sys_scope = strAppSysId;&#13;
		grSSI.access = 'public';&#13;
		grSSI.caller_access = '1';&#13;
		grSSI.script = ""&#13;
			+"function DataSilosRecordInsert(record)\n"&#13;
			+"{\n"&#13;
			+"\tvar IsValidRecord = x_snc_devtools.IsValidRecord;\n"&#13;
			+"\tvar RenderValue = x_snc_devtools.RenderValue;\n"&#13;
			+"\n"&#13;
			+"\tvar bResult = false;\n"&#13;
			+"\n"&#13;
			+"\tvar strTable = x_snc_datasilos.GetSupportedTableFromRecord(record);\n"&#13;
			+"\n"&#13;
			+"\treturn bResult;\n"&#13;
			+"}";&#13;
		strSSI = GlideRecordInsert(grSSI);&#13;
		Log('Script include "DataSilosRecordInsert": '+RenderValue(strSSI));	&#13;
	}	&#13;
&#13;
	&#13;
	// Adding script include "DataSilosRecordUpdate"&#13;
	var grSSI = new GlideRecord('sys_script_include');&#13;
	grSSI.addQuery('sys_scope','=',strAppSysId);&#13;
	grSSI.addQuery('name','=','DataSilosRecordUpdate');&#13;
	grSSI.query();&#13;
	if (grSSI.getRowCount() != 0)&#13;
	{&#13;
		Log('Script include "DataSilosRecordUpdate" already exists...');&#13;
	}&#13;
	else&#13;
	{&#13;
		Log('Adding script include "DataSilosRecordUpdate"...');&#13;
		var grSSI = new GlideRecord('sys_script_include');&#13;
		grSSI.initialize();&#13;
		grSSI.name = 'DataSilosRecordUpdate';&#13;
		grSSI.description = "The DataSilosRecordUpdate function is called by the DataSilos extension point instance class and processes a record when it is updated. Return true if the record is handled by the function, false if not.";&#13;
		grSSI.sys_scope = strAppSysId;&#13;
		grSSI.access = 'public';&#13;
		grSSI.caller_access = '1';&#13;
		grSSI.script = ""&#13;
			+"function DataSilosRecordUpdate(record)\n"&#13;
			+"{\n"&#13;
			+"\tvar IsValidRecord = x_snc_devtools.IsValidRecord;\n"&#13;
			+"\tvar RenderValue = x_snc_devtools.RenderValue;\n"&#13;
			+"\n"&#13;
			+"\tvar bResult = false;\n"&#13;
			+"\n"&#13;
			+"\tvar strTable = x_snc_datasilos.GetSupportedTableFromRecord(record);\n"&#13;
			+"\n"&#13;
			+"\treturn bResult;\n"&#13;
			+"}";&#13;
		strSSI = GlideRecordInsert(grSSI);&#13;
		Log('Script include "DataSilosRecordUpdate": '+RenderValue(strSSI));	&#13;
	}	&#13;
&#13;
	&#13;
	&#13;
	&#13;
	&#13;
	for (var nTable = 0; nTable &lt; aTables.length; nTable++)&#13;
	{&#13;
		var strTable = aTables[nTable];&#13;
		if (IsValidTable(strTable) == false)&#13;
		{&#13;
			Log('IsValidTable("'+strTable+'") returned false. Ignoring table.');&#13;
		}&#13;
		else&#13;
		{&#13;
			Log('Working on table "'+strTable+'"...');&#13;
&#13;
&#13;
			&#13;
			var strFieldSysId = '';&#13;
			var grSD = new GlideRecord('sys_dictionary');&#13;
			grSD.addQuery('name','=',strTable);&#13;
			grSD.addQuery('element','=',strAppScope+'_global');&#13;
			grSD.query();&#13;
			if (grSD.getRowCount() != 0)&#13;
			{&#13;
				grSD.next();&#13;
				strFieldSysId = GetStringValue(grSD.sys_id);&#13;
				Log('Field "Global" already exists in table "'+strTable+'".');&#13;
			}&#13;
			else&#13;
			{&#13;
				var grSD = new GlideRecord('sys_dictionary');&#13;
				grSD.initialize();&#13;
				grSD.active = true;&#13;
				grSD.calculation = "&lt;![CDATA[ (function calculatedFieldValue(current) { // Add your code here return ''; // return the calculated value })(current); ]]&gt;";&#13;
				grSD.column_label = 'DataSilos Global Visibility';&#13;
				grSD.default_value = 'false';&#13;
				grSD.element = strAppScope+'_global';&#13;
				grSD.internal_type = 'boolean';&#13;
				grSD.name = strTable;&#13;
				grSD.reference = null;&#13;
				grSD.sys_scope = strAppSysId;&#13;
				strFieldSysId = GlideRecordInsert(grSD);&#13;
				Log('Adding the "Global Visibility" field: '+RenderValue(strFieldSysId));&#13;
				AppBuilderFieldLabelsSetScope(strAppScope,strTable,'global',strAppScope);&#13;
			}&#13;
			&#13;
			if (IsValidSysId(strFieldSysId) == true)&#13;
			{&#13;
				AppBuilderAddFieldACL(strAppScope, strTable, 'global', strFieldSysId, 'read');&#13;
				AppBuilderAddFieldACL(strAppScope, strTable, 'global', strFieldSysId, 'write');&#13;
			}&#13;
			&#13;
			&#13;
			&#13;
			&#13;
			&#13;
			var strFieldSysId = '';&#13;
			var grSD = new GlideRecord('sys_dictionary');&#13;
			grSD.addQuery('name','=',strTable);&#13;
			grSD.addQuery('element','=',strAppScope+'_supervisor_whitelist');&#13;
			grSD.query();&#13;
			if (grSD.getRowCount() != 0)&#13;
			{&#13;
				grSD.next();&#13;
				strFieldSysId = GetStringValue(grSD.sys_id);&#13;
				Log('Field "Supervisor Whitelist" already exists in table "'+strTable+'".');&#13;
			}&#13;
			else&#13;
			{&#13;
				var grSD = new GlideRecord('sys_dictionary');&#13;
				grSD.initialize();&#13;
				grSD.active = true;&#13;
				grSD.attributes = 'edge_encryption_enabled=true,no_sort=true,slushbucket_ref_no_expand=true';&#13;
				grSD.audit = false;&#13;
				grSD.calculation = "&lt;![CDATA[ (function calculatedFieldValue(current) { // Add your code here return ''; // return the calculated value })(current); ]]&gt;";&#13;
				grSD.column_label = 'DataSilos Supervisor Whitelist';&#13;
				grSD.element = strAppScope+'_supervisor_whitelist';&#13;
				grSD.internal_type = 'glide_list';&#13;
				grSD.max_length = 4000;&#13;
				grSD.name = strTable;&#13;
				grSD.reference = 'x_snc_datasilos_datasilos';&#13;
				grSD.reference_cascade_rule = 'none';&#13;
				grSD.sys_scope = strAppSysId;&#13;
				grSD.use_reference_qualifier = 'simple';&#13;
				strFieldSysId = GlideRecordInsert(grSD);&#13;
				Log('Adding the "Supervisor Whitelist" field: '+RenderValue(strFieldSysId));&#13;
				AppBuilderFieldLabelsSetScope(strAppScope,strTable,'supervisor_whitelist',strAppScope);&#13;
			}&#13;
			&#13;
			if (IsValidSysId(strFieldSysId) == true)&#13;
			{&#13;
				AppBuilderAddFieldACL(strAppScope, strTable, 'supervisor_whitelist', strFieldSysId, 'read');&#13;
				AppBuilderAddFieldACL(strAppScope, strTable, 'supervisor_whitelist', strFieldSysId, 'write');&#13;
			}&#13;
			&#13;
			&#13;
			&#13;
			&#13;
			var strFieldSysId = '';&#13;
			var grSD = new GlideRecord('sys_dictionary');&#13;
			grSD.addQuery('name','=',strTable);&#13;
			grSD.addQuery('element','=',strAppScope+'_fulfiller_whitelist');&#13;
			grSD.query();&#13;
			if (grSD.getRowCount() != 0)&#13;
			{&#13;
				grSD.next();&#13;
				strFieldSysId = GetStringValue(grSD.sys_id);&#13;
				Log('Field "Fulfiller Whitelist" already exists in table "'+strTable+'".');&#13;
			}&#13;
			else&#13;
			{&#13;
				var grSD = new GlideRecord('sys_dictionary');&#13;
				grSD.initialize();&#13;
				grSD.active = true;&#13;
				grSD.attributes = 'edge_encryption_enabled=true,no_sort=true,slushbucket_ref_no_expand=true';&#13;
				grSD.calculation = "&lt;![CDATA[ (function calculatedFieldValue(current) { // Add your code here return ''; // return the calculated value })(current); ]]&gt;";&#13;
				grSD.column_label = 'DataSilos Fulfiller Whitelist';&#13;
				grSD.element = strAppScope+'_fulfiller_whitelist';&#13;
				grSD.internal_type = 'glide_list';&#13;
				grSD.max_length = 4000;&#13;
				grSD.name = strTable;&#13;
				grSD.reference = 'x_snc_datasilos_datasilos';&#13;
				grSD.reference_cascade_rule = 'none';&#13;
				grSD.sys_scope = strAppSysId;&#13;
				grSD.use_reference_qualifier = 'simple';&#13;
				strFieldSysId = GlideRecordInsert(grSD);&#13;
				Log('Adding the "Fulfiller Whitelist" field: '+RenderValue(strFieldSysId));&#13;
				AppBuilderFieldLabelsSetScope(strAppScope,strTable,'fulfiller_whitelist',strAppScope);&#13;
			}&#13;
			&#13;
			if (IsValidSysId(strFieldSysId) == true)&#13;
			{&#13;
				AppBuilderAddFieldACL(strAppScope, strTable, 'fulfiller_whitelist', strFieldSysId, 'read');&#13;
				AppBuilderAddFieldACL(strAppScope, strTable, 'fulfiller_whitelist', strFieldSysId, 'write');&#13;
			}&#13;
&#13;
&#13;
			&#13;
			&#13;
			var strFieldSysId = '';&#13;
			var grSD = new GlideRecord('sys_dictionary');&#13;
			grSD.addQuery('name','=',strTable);&#13;
			grSD.addQuery('element','=',strAppScope+'_group_whitelist');&#13;
			grSD.query();&#13;
			if (grSD.getRowCount() != 0)&#13;
			{&#13;
				grSD.next();&#13;
				strFieldSysId = GetStringValue(grSD.sys_id);&#13;
				Log('Field "Group Whitelist" already exists in table "'+strTable+'".');&#13;
			}&#13;
			else&#13;
			{&#13;
				var grSD = new GlideRecord('sys_dictionary');&#13;
				grSD.initialize();&#13;
				grSD.active = true;&#13;
				grSD.attributes = 'edge_encryption_enabled=true,no_sort=true,slushbucket_ref_no_expand=true';&#13;
				grSD.calculation = "&lt;![CDATA[ (function calculatedFieldValue(current) { // Add your code here return ''; // return the calculated value })(current); ]]&gt;";&#13;
				grSD.column_label = 'DataSilos Group Whitelist';&#13;
				grSD.element = strAppScope+'_group_whitelist';&#13;
				grSD.internal_type = 'glide_list';&#13;
				grSD.max_length = 4000;&#13;
				grSD.name = strTable;&#13;
				grSD.reference = 'sys_user_group';&#13;
				grSD.reference_cascade_rule = 'none';&#13;
				grSD.sys_scope = strAppSysId;&#13;
				grSD.use_reference_qualifier = 'simple';&#13;
				strFieldSysId = GlideRecordInsert(grSD);&#13;
				Log('Adding the "Group Whitelist" field: '+RenderValue(strFieldSysId));&#13;
				AppBuilderFieldLabelsSetScope(strAppScope,strTable,'group_whitelist',strAppScope);&#13;
			}&#13;
			if (IsValidSysId(strFieldSysId) == true)&#13;
			{&#13;
				AppBuilderAddFieldACL(strAppScope, strTable, 'group_whitelist', strFieldSysId, 'read');&#13;
				AppBuilderAddFieldACL(strAppScope, strTable, 'group_whitelist', strFieldSysId, 'write');&#13;
			}&#13;
			&#13;
			&#13;
			&#13;
			var strFieldSysId = '';&#13;
			var grSD = new GlideRecord('sys_dictionary');&#13;
			grSD.addQuery('name','=',strTable);&#13;
			grSD.addQuery('element','=',strAppScope+'_security_clearance');&#13;
			grSD.query();&#13;
			if (grSD.getRowCount() != 0)&#13;
			{&#13;
				grSD.next();&#13;
				strFieldSysId = GetStringValue(grSD.sys_id);&#13;
				Log('Field "Security Clearance" already exists in table "'+strTable+'".');&#13;
			}&#13;
			else&#13;
			{&#13;
				var grSD = new GlideRecord('sys_dictionary');&#13;
				grSD.initialize();&#13;
				grSD.active = true;&#13;
				grSD.calculation = "&lt;![CDATA[ (function calculatedFieldValue(current) { // Add your code here return ''; // return the calculated value })(current); ]]&gt;";&#13;
				grSD.column_label = 'DataSilos Security Clearance';&#13;
				grSD.default_value = '0';&#13;
				grSD.element = strAppScope+'_security_clearance';&#13;
				grSD.internal_type = 'integer';&#13;
				grSD.name = strTable;&#13;
				grSD.sys_scope = strAppSysId;&#13;
				strFieldSysId = GlideRecordInsert(grSD);&#13;
				Log('Adding the "Security Clearance" field: '+RenderValue(strFieldSysId));&#13;
				AppBuilderFieldLabelsSetScope(strAppScope,strTable,'security_clearance',strAppScope);&#13;
			}&#13;
			if (IsValidSysId(strFieldSysId) == true)&#13;
			{&#13;
				AppBuilderAddFieldACL(strAppScope, strTable, 'security_clearance', strFieldSysId, 'read');&#13;
				AppBuilderAddFieldACL(strAppScope, strTable, 'security_clearance', strFieldSysId, 'write');&#13;
			}	&#13;
			&#13;
		&#13;
			&#13;
			var strFieldSysId = '';&#13;
			var grSD = new GlideRecord('sys_dictionary');&#13;
			grSD.addQuery('name','=',strTable);&#13;
			grSD.addQuery('element','ENDSWITH','_ghost');&#13;
			grSD.query();&#13;
			if (grSD.getRowCount() != 0)&#13;
			{&#13;
				grSD.next();&#13;
				strFieldSysId = GetStringValue(grSD.sys_id);&#13;
				Log('Field "Ghost" already exists in table "'+strTable+'".');&#13;
			}&#13;
			else&#13;
			{&#13;
				var grSD = new GlideRecord('sys_dictionary');&#13;
				grSD.initialize();&#13;
				grSD.active = true;&#13;
				grSD.calculation = "&lt;![CDATA[ (function calculatedFieldValue(current) { // Add your code here return ''; // return the calculated value })(current); ]]&gt;";&#13;
				grSD.column_label = 'DataSilos Ghost';&#13;
				grSD.default_value = 'false';&#13;
				grSD.element = strAppScope+'_ghost';&#13;
				grSD.internal_type = 'boolean';&#13;
				grSD.name = strTable;&#13;
				grSD.sys_scope = strAppSysId;&#13;
				strFieldSysId = GlideRecordInsert(grSD);&#13;
				Log('Adding the "Ghost" field: '+RenderValue(strFieldSysId));&#13;
				AppBuilderFieldLabelsSetScope(strAppScope,strTable,'ghost',strAppScope);&#13;
			}&#13;
			if (IsValidSysId(strFieldSysId) == true)&#13;
			{&#13;
				AppBuilderAddFieldACL(strAppScope, strTable, 'ghost', strFieldSysId, 'read');&#13;
				AppBuilderAddFieldACL(strAppScope, strTable, 'ghost', strFieldSysId, 'write');&#13;
			}&#13;
			&#13;
&#13;
			var strFieldSysId = '';&#13;
			var grSD = new GlideRecord('sys_dictionary');&#13;
			grSD.addQuery('name','=',strTable);&#13;
			grSD.addQuery('element','=',strAppScope+'_last_maintenance');&#13;
			grSD.query();&#13;
			if (grSD.getRowCount() != 0)&#13;
			{&#13;
				grSD.next();&#13;
				strFieldSysId = GetStringValue(grSD.sys_id);&#13;
				Log('Field "Last Maintenance" already exists in table "'+strTable+'".');&#13;
			}&#13;
			else&#13;
			{&#13;
				var grSD = new GlideRecord('sys_dictionary');&#13;
				grSD.initialize();&#13;
				grSD.active = true;&#13;
				grSD.calculation = "&lt;![CDATA[ (function calculatedFieldValue(current) { // Add your code here return ''; // return the calculated value })(current); ]]&gt;";&#13;
				grSD.column_label = 'DataSilos Last Maintenance';&#13;
				grSD.default_value = '';&#13;
				grSD.element = strAppScope+'_last_maintenance';&#13;
				grSD.internal_type = 'glide_date_time';&#13;
				grSD.name = strTable;&#13;
				grSD.sys_scope = strAppSysId;&#13;
				strFieldSysId = GlideRecordInsert(grSD);&#13;
				Log('Adding the "Last Maintenance" field: '+RenderValue(strFieldSysId));&#13;
				AppBuilderFieldLabelsSetScope(strAppScope,strTable,'last_maintenance',strAppScope);&#13;
&#13;
			}&#13;
			if (IsValidSysId(strFieldSysId) == true)&#13;
			{&#13;
				AppBuilderAddFieldACL(strAppScope, strTable, 'last_maintenance', strFieldSysId, 'read');&#13;
				AppBuilderAddFieldACL(strAppScope, strTable, 'last_maintenance', strFieldSysId, 'write');&#13;
			}&#13;
			&#13;
			&#13;
			&#13;
			&#13;
			Log('Working on table maintenance scheduled job...');&#13;
			var strJobName = 'DataSilos - Maintenance - '+strTable;&#13;
			var grSA = new GlideRecord('sysauto_script');&#13;
			grSA.addQuery('name','=',strJobName);&#13;
			grSA.addQuery('sys_scope','=',strAppSysId);&#13;
			grSA.query();&#13;
			if (grSA.getRowCount() != 0)&#13;
			{&#13;
				grSA.next();&#13;
				Log('Maintenance scheduled job already exists for table "'+strTable+'".');&#13;
			}&#13;
			else&#13;
			{&#13;
				var grSA = new GlideRecord('sysauto_script');&#13;
				grSA.initialize();&#13;
				grSA.name = strJobName;&#13;
				grSA.sys_scope = strAppSysId;&#13;
				grSA.active = true;&#13;
				grSA.conditional = false;&#13;
				grSA.run_as = '6816f79cc0a8016401c5a33be04be441'; // system admin&#13;
				grSA.run_dayofmonth = '1';&#13;
				grSA.run_dayofweek = '1';&#13;
				grSA.run_time = '1969-12-31 23:00:00';&#13;
				grSA.run_period.setDateNumericValue(600000); // 10 minutes&#13;
				grSA.run_type = 'periodically';&#13;
				var strScript = ""&#13;
					+"var grRecords = new GlideRecord('"+strTable+"');\n"&#13;
					+"x_snc_datasilos.Maintenance(grRecords);";&#13;
				grSA.script = strScript;				&#13;
				var strJobSysId = GlideRecordInsert(grSA);&#13;
				Log('Scheduled job: '+RenderValue(strJobSysId));&#13;
			}&#13;
					&#13;
			&#13;
			Log('Working on business rule...');&#13;
			var strBusinessRuleName = 'DataSilos - '+x_snc_devtools.GetShortUniqueString(strTable,40-12);&#13;
			var grBR = new GlideRecord('sys_script');&#13;
			grBR.addQuery('name','=',strBusinessRuleName);&#13;
			grBR.addQuery('sys_scope','=',strAppSysId);&#13;
			grBR.query();&#13;
			if (grBR.getRowCount() != 0)&#13;
			{&#13;
				grBR.next();&#13;
				Log('Business rule already exists for table "'+strTable+'".');&#13;
			}&#13;
			else&#13;
			{&#13;
				var grBR = new GlideRecord('sys_script');&#13;
				grBR.initialize();&#13;
				grBR.active = true;&#13;
				grBR.name = strBusinessRuleName;&#13;
				grBR.sys_scope = strAppSysId;&#13;
				grBR.action_insert = true;&#13;
				grBR.action_update = true;&#13;
				grBR.action_query = true;&#13;
				grBR.advanced = true;&#13;
				grBR.when = 'before';&#13;
				grBR.order = 10000;&#13;
				grBR.collection = strTable;&#13;
				var strScript = ""&#13;
					+"(function executeRule(current, previous /*null when async*/) {\n"&#13;
					+"\tx_snc_datasilos.ExecuteBusinessRule(current, previous);\n"&#13;
					+"})(current, previous);";&#13;
				grBR.script = strScript;				&#13;
				var strBusinessRuleSysId = GlideRecordInsert(grBR);&#13;
				Log('Business rule: '+RenderValue(strBusinessRuleSysId));&#13;
			}&#13;
			&#13;
			&#13;
			var grSSI = new GlideRecord('sys_script_include');&#13;
			grSSI.addQuery('sys_scope','=',strAppSysId);&#13;
			grSSI.addQuery('name','=','DataSilosGetConfig');&#13;
			grSSI.query();&#13;
			if (grSSI.next() == false)&#13;
			{&#13;
				Log('ERROR: Script include "DataSilosGetConfig" DOES NOT EXIST...');&#13;
			}&#13;
			else&#13;
			{&#13;
				Log('Modifying script include "DataSilosGetConfig"...');&#13;
				var strScript = GetStringValue(grSSI.script);&#13;
				if (strScript.indexOf('return config;') == -1)&#13;
				{&#13;
					Log('ERROR: Script include "DataSilosGetConfig" DOES NOT SEEM TO BE IMPLEMENTED CORRECTLY...');&#13;
				}&#13;
				if (strScript.indexOf("config['tables']['"+strTable+"'] =") == -1)&#13;
				{&#13;
					strScriptTableConfig = ""&#13;
						+"config['tables']['"+strTable+"'] =\n"&#13;
						+"\t{\n"&#13;
						+"\t\t'scope': '"+strAppScope+"',\n"&#13;
						+"\t\t'active': true,\n"&#13;
						+"\t\t'avoid_expensive_queries': false,\n"&#13;
						+"\t\t'columns':\n"&#13;
						+"\t\t{\n"&#13;
						+"\t\t\t'instant_access':\n"&#13;
						+"\t\t\t{\n"&#13;
						+"\t\t\t\t'sys_user': ''\n"&#13;
						+"\t\t\t},\n"&#13;
						+"\t\t\t'whitelist_trigger':\n"&#13;
						+"\t\t\t{\n"&#13;
						+"\t\t\t\t'sys_user_group': ''\n"&#13;
						+"\t\t\t},\n"&#13;
						+"\t\t}\n"&#13;
						+"\t};\n"&#13;
						+"\t\n"&#13;
						+"\treturn config;";&#13;
					strScript = strScript.replace('return config;',strScriptTableConfig);&#13;
					grSSI.script = strScript;&#13;
					strSSI = GlideRecordUpdate(grSSI);&#13;
					Log('Updating script include "DataSilosGetConfig": '+RenderValue(strSSI));	&#13;
				}&#13;
				&#13;
			}&#13;
				&#13;
			&#13;
			var grSSI = new GlideRecord('sys_script_include');&#13;
			grSSI.addQuery('sys_scope','=',strAppSysId);&#13;
			grSSI.addQuery('name','=','DataSilosGetRelatedRecords');&#13;
			grSSI.query();&#13;
			if (grSSI.next() == false)&#13;
			{&#13;
				Log('ERROR: Script include "DataSilosGetRelatedRecords" DOES NOT EXIST...');&#13;
			}&#13;
			else&#13;
			{&#13;
				Log('Modifying script include "DataSilosGetRelatedRecords"...');&#13;
				var strScript = GetStringValue(grSSI.script);&#13;
				if (strScript.indexOf('return false;') == -1)&#13;
				{&#13;
					Log('ERROR: Script include "DataSilosGetRelatedRecords" DOES NOT SEEM TO BE IMPLEMENTED CORRECTLY...');&#13;
				}&#13;
				if (strScript.indexOf("if (strTable == '"+strTable+"')") == -1)&#13;
				{&#13;
					strScriptTableConfig = ""&#13;
						+"if (strTable == '"+strTable+"')\n"&#13;
						+"\t{\n"&#13;
						+"\t\t// Add your code here...\n"&#13;
						+"\t\treturn aRelatedRecords;\n"&#13;
						+"\t}\n"&#13;
						+"\t\n"&#13;
						+"\treturn false;";&#13;
					strScript = strScript.replace('return false;',strScriptTableConfig);&#13;
					grSSI.script = strScript;&#13;
					strSSI = GlideRecordUpdate(grSSI);&#13;
					Log('Updating script include "DataSilosGetRelatedRecords": '+RenderValue(strSSI));	&#13;
				}&#13;
				&#13;
			}&#13;
			&#13;
&#13;
			&#13;
			var grSSI = new GlideRecord('sys_script_include');&#13;
			grSSI.addQuery('sys_scope','=',strAppSysId);&#13;
			grSSI.addQuery('name','=','DataSilosRecordInsert');&#13;
			grSSI.query();&#13;
			if (grSSI.next() == false)&#13;
			{&#13;
				Log('ERROR: Script include "DataSilosRecordInsert" DOES NOT EXIST...');&#13;
			}&#13;
			else&#13;
			{&#13;
				Log('Modifying script include "DataSilosRecordInsert"...');&#13;
				var strScript = GetStringValue(grSSI.script);&#13;
				if (strScript.indexOf('var strTable = x_snc_datasilos.GetSupportedTableFromRecord(record);') == -1)&#13;
				{&#13;
					Log('ERROR: Script include "DataSilosRecordInsert" DOES NOT SEEM TO BE IMPLEMENTED CORRECTLY...');&#13;
				}&#13;
				if (strScript.indexOf("if (strTable == '"+strTable+"')") == -1)&#13;
				{&#13;
					strScriptTableConfig = ""&#13;
						+"if (strTable == '"+strTable+"')\n"&#13;
						+"\t{\n"&#13;
						+"\t\t//Add your code here...\n"&#13;
						+"\t\tbResult = true;\n"&#13;
						+"\t}\n"&#13;
						+"\t\n"&#13;
						+"\treturn bResult;";&#13;
					strScript = strScript.replace('return bResult;',strScriptTableConfig);&#13;
					grSSI.script = strScript;&#13;
					strSSI = GlideRecordUpdate(grSSI);&#13;
					Log('Updating script include "DataSilosRecordInsert": '+RenderValue(strSSI));	&#13;
				}&#13;
			}&#13;
			&#13;
			&#13;
			&#13;
			var grSSI = new GlideRecord('sys_script_include');&#13;
			grSSI.addQuery('sys_scope','=',strAppSysId);&#13;
			grSSI.addQuery('name','=','DataSilosRecordUpdate');&#13;
			grSSI.query();&#13;
			if (grSSI.next() == false)&#13;
			{&#13;
				Log('ERROR: Script include "DataSilosRecordUpdate" DOES NOT EXIST...');&#13;
			}&#13;
			else&#13;
			{&#13;
				Log('Modifying script include "DataSilosRecordUpdate"...');&#13;
				var strScript = GetStringValue(grSSI.script);&#13;
				if (strScript.indexOf('var strTable = x_snc_datasilos.GetSupportedTableFromRecord(record);') == -1)&#13;
				{&#13;
					Log('ERROR: Script include "DataSilosRecordUpdate" DOES NOT SEEM TO BE IMPLEMENTED CORRECTLY...');&#13;
				}&#13;
				if (strScript.indexOf("if (strTable == '"+strTable+"')") == -1)&#13;
				{&#13;
					strScriptTableConfig = ""&#13;
						+"if (strTable == '"+strTable+"')\n"&#13;
						+"\t{\n"&#13;
						+"\t\t//Add your code here...\n"&#13;
						+"\t\tbResult = true;\n"&#13;
						+"\t}\n"&#13;
						+"\t\n"&#13;
						+"\treturn bResult;";&#13;
					strScript = strScript.replace('return bResult;',strScriptTableConfig);&#13;
					grSSI.script = strScript;&#13;
					strSSI = GlideRecordUpdate(grSSI);&#13;
					Log('Updating script include "DataSilosRecordUpdate": '+RenderValue(strSSI));	&#13;
				}&#13;
			}&#13;
			&#13;
			&#13;
			&#13;
		}&#13;
	}&#13;
	&#13;
	&#13;
	&#13;
	// Modify AppGetDependencies script include&#13;
	var grSI = new GlideRecord('sys_script_include');&#13;
	grSI.addQuery('sys_scope','=',strAppSysId);&#13;
	grSI.addQuery('name','=','AppGetDependencies');&#13;
	grSI.query();&#13;
	while (grSI.next())&#13;
	{&#13;
		var strScript = GetStringValue(grSI.script);&#13;
		if (strScript.indexOf("name: 'DataSilos'") == -1)&#13;
		{&#13;
			Log('Modifying script include AppGetDependencies to add dependency to DataSilos...');&#13;
		&#13;
			strScriptDataSilosDependency = ""&#13;
				+"\t,\n"&#13;
				+"\t\t{\n"&#13;
				+"\t\t\tname: 'DataSilos',\n"&#13;
				+"\t\t\tversion: '"+strDataSilosVersion+"',\n"&#13;
				+"\t\t\turl: 'https://github.com/saschawildgrube/servicenow-datasilos/',\n"&#13;
				+"\t\t\twebsite_url: 'https://www.wildgrube.com/servicenow-datasilos'\n"&#13;
				+"\t\t}\n"&#13;
				+"\t];";&#13;
			&#13;
			strScript = strScript.replace('];',strScriptDataSilosDependency);&#13;
			grSI.script = strScript;&#13;
			GlideRecordUpdate(grSI);&#13;
		}&#13;
	}&#13;
	&#13;
	&#13;
	&#13;
	&#13;
	&#13;
	// Adding script include "DataSilos" which implements the extension point&#13;
	var strDataSilosScriptInclude = false;&#13;
	var strScript = RecordGetValue('sys_extension_point','68e24c12db76b8104647dad1f396198e','example');&#13;
	strScript = strScript.replaceAll('x_this_app_scope',strAppScope);&#13;
	var grSSI = new GlideRecord('sys_script_include');&#13;
	grSSI.addQuery('sys_scope','=',strAppSysId);&#13;
	grSSI.addQuery('name','=','DataSilos');&#13;
	grSSI.query();&#13;
	if (grSSI.getRowCount() != 0)&#13;
	{&#13;
		Log('Script include "DataSilos" already exists. Updating it...');&#13;
		grSSI.next();&#13;
		grSSI.script = strScript;&#13;
		GlideRecordUpdate(grSSI);&#13;
		strDataSilosScriptInclude = grSSI.sys_id;&#13;
	}&#13;
	else&#13;
	{&#13;
		Log('Adding script include "DataSilos"...');&#13;
		var grSSI = new GlideRecord('sys_script_include');&#13;
		grSSI.initialize();&#13;
		grSSI.name = 'DataSilos';&#13;
		grSSI.description = "Implements the extension point for DataSilos.";&#13;
		grSSI.sys_scope = strAppSysId;&#13;
		grSSI.access = 'public';&#13;
		grSSI.caller_access = '1';&#13;
		grSSI.script = strScript;&#13;
		strDataSilosScriptInclude = GlideRecordInsert(grSSI);&#13;
	}&#13;
	Log('Script include "DataSilos": '+RenderValue(strDataSilosScriptInclude));&#13;
&#13;
	// Adding extension point instance&#13;
	var strEPI = false;&#13;
	var grEPI = new GlideRecord('sys_extension_instance');&#13;
	grEPI.addQuery('sys_scope','=',strAppSysId);&#13;
	grEPI.addQuery('point','=','x_snc_datasilos.DataSilos');&#13;
	grEPI.query();&#13;
	if (grEPI.getRowCount() != 0)&#13;
	{&#13;
		grEPI.next();&#13;
		Log('Extension point instance for "DataSilos" already exists: '+grEPI.sys_id);&#13;
	}&#13;
	else&#13;
	{&#13;
		Log('Adding extension point instance for "DataSilos"...');&#13;
		var grEPI = new GlideRecord('sys_extension_instance');&#13;
		grEPI.initialize();&#13;
		grEPI.active = true;&#13;
		grEPI.point = 'x_snc_datasilos.DataSilos';&#13;
		grEPI.sys_scope = strAppSysId;&#13;
		grEPI.script_include = strDataSilosScriptInclude;&#13;
		grEPI.order = 100;&#13;
		strEPI = GlideRecordInsert(grEPI);&#13;
		Log('Adding extension point instance for "DataSilos": '+RenderValue(strEPI));&#13;
	}&#13;
&#13;
	&#13;
	&#13;
	Log('Done!');&#13;
	&#13;
	return grApp;&#13;
&#13;
&#13;
	function AppBuilderFieldLabelsSetScope(strAppScope,strTable,strColumn,strScope)&#13;
	{&#13;
		var grSD = new GlideRecord('sys_documentation');&#13;
		grSD.addQuery('name','=',strTable);&#13;
		grSD.addQuery('element','=',strAppScope+'_'+strColumn);&#13;
		grSD.query();&#13;
		while (grSD.next())&#13;
		{&#13;
			grSD.sys_scope = strScope;&#13;
			GlideRecordUpdate(grSD);&#13;
		}&#13;
	}&#13;
&#13;
	function AppBuilderAddFieldACL(strAppScope, strTable, strFieldName, strFieldSysId,strOperation)&#13;
	{&#13;
		strAppScope = GetStringValue(strAppScope);&#13;
		strTable = GetStringValue(strTable);&#13;
		strFieldName = GetStringValue(strFieldName);&#13;
		strFieldSysId = GetStringValue(strFieldSysId);&#13;
		strOperation = GetStringValue(strOperation);&#13;
&#13;
		Log('Working on ACL for "'+strOperation+'" operation...');&#13;
		var strAclName = strTable+'.'+strAppScope+'_'+strFieldName;&#13;
		var strAclSysId = '';&#13;
		var grSSA = new GlideRecord('sys_security_acl');&#13;
		grSSA.addQuery('type','=','record');&#13;
		grSSA.addQuery('operation','=',strOperation);&#13;
		grSSA.addQuery('name','=',strAclName);&#13;
		grSSA.query();&#13;
		if (grSSA.getRowCount() != 0)&#13;
		{&#13;
			grSSA.next();&#13;
			strAclSysId = GetStringValue(grSSA.sys_id);&#13;
			Log('ACL for "'+strOperation+'" operation already exists for field "'+strFieldName+'" in table "'+strTable+'".');&#13;
		}&#13;
		else&#13;
		{&#13;
			var grSSA = new GlideRecord('sys_security_acl');&#13;
			grSSA.initialize();&#13;
			grSSA.active = true;&#13;
			grSSA.admin_overrides = true;&#13;
			grSSA.advanced = false;&#13;
			grSSA.name  = strAclName; &#13;
			grSSA.operation = strOperation;&#13;
			grSSA.sys_scope = strAppSysId;&#13;
			grSSA.type = 'record';&#13;
			strAclSysId = GlideRecordInsert(grSSA);&#13;
			Log('Adding ACL for "'+strOperation+'" operation for field "'+strFieldName+'": '+RenderValue(strAclSysId));&#13;
		}&#13;
&#13;
&#13;
		if (IsValidSysId(strAclSysId) == true)&#13;
		{&#13;
			// Add Role&#13;
			Log('Working on ACL role...');&#13;
			var strAclRoleSysId = '';&#13;
			var grSSAR = new GlideRecord('sys_security_acl_role');&#13;
			grSSAR.addQuery('sys_security_acl','=',strAclSysId);&#13;
			grSSAR.addQuery('sys_user_role','=','23df0da71b48d490a89720a8ec4bcb72'); // x_snc_datasilos.manager&#13;
			grSSAR.query();&#13;
			if (grSSAR.getRowCount() != 0)&#13;
			{&#13;
				grSSAR.next();&#13;
				strAclRoleSysId = GetStringValue(grSSAR.sys_id);&#13;
				Log('Role for ACL for "'+strOperation+'" operation already exists for field "'+strFieldName+'" in table "'+strTable+'".');&#13;
			}&#13;
			else&#13;
			{&#13;
				var grSSAR = new GlideRecord('sys_security_acl_role');&#13;
				grSSAR.initialize();&#13;
				grSSAR.sys_scope = strAppSysId;&#13;
				grSSAR.sys_security_acl = strAclSysId;&#13;
				grSSAR.sys_user_role = '23df0da71b48d490a89720a8ec4bcb72'; // x_snc_datasilos.manager;&#13;
				strAclRoleSysId = GlideRecordInsert(grSSAR);&#13;
				Log('Role for "'+strFieldName+'" ACL for "'+strOperation+'" operation: '+RenderValue(strAclRoleSysId));&#13;
			}&#13;
		}&#13;
	}&#13;
&#13;
&#13;
}</script>
        <sys_class_name>sys_script_include</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2021-09-28 09:53:31</sys_created_on>
        <sys_id>ac1cf47e1b3af810edf3642aab4bcb45</sys_id>
        <sys_mod_count>85</sys_mod_count>
        <sys_name>AppBuilder</sys_name>
        <sys_package display_value="DataSilos WORK IN PROGRESS" source="x_snc_datasilos">dafbffebdbb78450ba15a353059619eb</sys_package>
        <sys_policy>read</sys_policy>
        <sys_scope display_value="DataSilos WORK IN PROGRESS">dafbffebdbb78450ba15a353059619eb</sys_scope>
        <sys_update_name>sys_script_include_ac1cf47e1b3af810edf3642aab4bcb45</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2021-11-10 08:44:45</sys_updated_on>
    </sys_script_include>
</record_update>
